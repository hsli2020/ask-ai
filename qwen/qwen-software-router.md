# 什么是软路由？

软路由（Software Router）是指通过通用计算机硬件（如 x86 服务器、PC、迷你主机、甚至虚拟机）运行专门的路由操作系统（如 OpenWrt、pfSense、OPNsense、DD-WRT 等），来实现传统硬件路由器功能的一种网络设备方案。

与传统的“硬路由”（即厂商预装固件、硬件和软件高度集成的专用路由器）不同，软路由的核心特点是“软件定义网络”——将路由、防火墙、NAT、QoS、VPN、流量控制、广告过滤等网络功能通过软件实现，运行在通用硬件平台上。

### 软路由的主要特点：

1. **灵活性高**  
   用户可以根据需求自由安装、配置各种网络功能插件或服务（如科学上网、广告屏蔽、内网穿透、DDNS、NAS 集成等）。

2. **性能可扩展**  
   可根据实际需求选择更高性能的 CPU、更多网口、更大内存的硬件，突破传统家用路由器的性能瓶颈（尤其在多设备、高带宽、复杂规则场景下优势明显）。

3. **开源与可定制**  
   大多数软路由系统基于开源项目（如 OpenWrt、pfSense），用户可深度定制系统、修改源码、添加自定义脚本。

4. **成本效益**  
   利用旧电脑或低价迷你主机（如 Intel N100 主机）搭建软路由，往往比购买高端企业级路由器更经济。

5. **功能丰富**  
   支持高级网络功能，如：
   - 多 WAN 口负载均衡
   - 精细化流量控制（QoS）
   - 强大的防火墙规则（如 Suricata 入侵检测）
   - 内建 DNS 广告过滤（AdGuard Home、dnsmasq）
   - WireGuard / OpenVPN 服务端
   - Docker 容器支持（部分系统）

### 常见软路由系统：

- **OpenWrt**：轻量、社区活跃，适合 x86 和 ARM 设备，插件生态丰富。
- **pfSense**：基于 FreeBSD，功能强大，适合企业级应用。
- **OPNsense**：pfSense 的分支，界面更现代，强调安全与隐私。
- **iStoreOS / 爱快 / 老毛子 Padavan**：国内流行的定制版，对中文用户友好，集成常用插件。

### 适用场景：

- 家庭网络高级管理（如全屋去广告、科学上网、家长控制）
- 小型企业网络网关
- 网络实验与学习（如搭建虚拟网络环境）
- 替代老旧或性能不足的家用路由器

### 注意事项：

- 需要一定的网络和 Linux 基础知识
- 硬件需支持多网口（通常至少 2 个千兆网口）
- 功耗和稳定性需考虑（建议使用低功耗迷你主机）

总之，软路由是一种“用软件赋予通用硬件路由器能力”的技术方案，为用户提供了远超传统路由器的自由度和功能扩展性。

# 我的家庭网络已经有了运营商提供的硬路由，在这种情况下安装软路由还可行吗，还有必要吗，软路由和硬路由能否共存？

你的问题非常实际！**在已有运营商提供的硬路由（光猫/路由器一体机）的情况下，安装软路由不仅可行，而且常常非常有必要**，两者完全可以共存，甚至能形成优势互补。下面从必要性、可行性、共存方式和实际建议几个方面详细说明：

---

### 一、为什么还有必要加软路由？

运营商提供的硬路由通常存在以下局限：

| 问题 | 说明 |
|------|------|
| **性能弱** | CPU、内存小，带机量低，多设备或高带宽（如千兆宽带）下容易卡顿。 |
| **功能简陋** | 缺少高级功能：如广告过滤、精细化 QoS、科学上网、内网穿透、Docker 等。 |
| **固件封闭** | 无法刷机、无法安装插件，安全性与隐私性差（部分厂商会收集用户数据）。 |
| **Wi-Fi 性能一般** | 虽然带无线，但天线和芯片较弱，覆盖和稳定性不如专业 AP。 |

👉 **软路由正好可以弥补这些短板**：提供更强的网络控制能力、更高的安全性和可玩性。

---

### 二、软路由和硬路由能否共存？如何共存？

**完全可以共存！** 常见的部署方式有以下几种：

#### ✅ 方式 1：**光猫桥接 + 软路由拨号（推荐）**
- **操作**：联系运营商将光猫设置为“桥接模式”（不再路由，只负责光电转换），由软路由进行 PPPoE 拨号上网。
- **优点**：
  - 网络层级最简洁（光猫 → 软路由 → 内网）
  - 软路由完全掌控所有网络流量，功能最大化
  - 避免双重 NAT（Double NAT），提升性能和兼容性（如游戏、远程访问）
- **注意**：需运营商配合改桥接（部分地区可能拒绝，但多数可操作）。

#### ✅ 方式 2：**光猫路由模式 + 软路由作为二级路由（最常见）**
- **操作**：保留光猫的路由和拨号功能，将软路由 WAN 口接光猫 LAN 口，软路由工作在二级路由模式。
- **优点**：
  - 无需改动光猫，部署简单
  - 软路由仍可实现大部分高级功能（如广告过滤、科学上网等）
- **缺点**：
  - 存在双重 NAT，可能影响某些应用（如 UPnP、远程访问）
  - 光猫性能瓶颈仍存在（但软路由可接管内网管理）

> 💡 小技巧：可在软路由上开启 **DHCP 关闭 + 接入交换机模式（AP 模式）**，让软路由只做“旁路由”（见下文）。

#### ✅ 方式 3：**旁路由（旁挂网关）模式（适合不想改主路由结构）**
- **操作**：
  - 软路由与光猫接在同一交换机下，不接 WAN 口
  - 软路由设置静态 IP（如 192.168.1.2），关闭 DHCP
  - 在需要使用软路由功能的设备上，手动将网关/DNS 指向软路由 IP
- **优点**：
  - 不改变原有网络结构
  - 可选择性地让部分设备走软路由（如手机、电脑），其他设备仍走光猫
- **适合场景**：只想给特定设备加广告过滤或科学上网，又不想折腾主路由。

---

### 三、是否“有必要”？取决于你的需求

| 如果你有以下需求 👉 | 建议加软路由 |
|------------------|-------------|
| 想全屋去广告（如 YouTube、App 广告） | ✅ |
| 需要科学上网、内网穿透、远程访问 NAS | ✅ |
| 家里设备多（>10 台），光猫经常卡顿 | ✅ |
| 对网络隐私/安全有较高要求 | ✅ |
| 喜欢折腾、学习网络知识 | ✅ |
| 仅用于刷视频、微信、普通上网 | ❌（可能没必要）|

---

### 四、实际建议（家庭用户）

1. **优先尝试“光猫桥接 + 软路由拨号”**：这是最干净高效的方案。
2. **若无法桥接，用“二级路由”或“旁路由”过渡**：也能获得大部分功能。
3. **Wi-Fi 问题**：软路由通常不擅长无线（除非带无线网卡），建议搭配 **单独的无线 AP**（如支持 AC+AP 的路由器，或 Mesh 系统）提供 Wi-Fi，软路由专注做网关。
4. **硬件选择**：入门可用 Intel N100 迷你主机（4 网口版约 600–800 元），功耗低、性能足。

---

### 总结

> ✅ **软路由和运营商硬路由完全可以共存**，且在多数家庭网络中**非常值得部署**。  
> 它不是“替代”，而是“增强”——让你从“能上网”升级到“智能、安全、可控的上网”。

如果你愿意动手，软路由会极大提升家庭网络体验；如果怕麻烦，至少可以先试试“旁路由”模式，风险低、效果明显。

# 请详细讲一下旁路由

当然可以！**旁路由（也叫旁挂路由、旁路网关）** 是一种非常实用且灵活的软路由部署方式，特别适合**不想改动现有家庭网络结构**、又希望部分或全部设备享受软路由高级功能（如广告过滤、科学上网、内网穿透等）的用户。

下面从原理、配置方法、优缺点、适用场景等方面详细讲解。

---

## 一、什么是旁路由？

> **旁路由 = 不作为主网关，而是“挂在”主路由旁边，通过修改设备网关或 DNS 来引导流量经过它。**

- 主路由（如运营商光猫）仍然负责拨号、分配 IP、提供 Wi-Fi。
- 旁路由不参与 DHCP 分配，也不直接连接 WAN 口，而是像一台“特殊内网设备”一样接入局域网。
- 当某台设备的**默认网关**或**DNS**指向旁路由时，它的网络请求就会被“引导”经过旁路由处理，再由旁路由转发回主路由出去。

✅ **本质：旁路由是一个“可选的中间代理/网关”，而非强制的全网出口。**

---

## 二、旁路由的工作原理（图解简化）

```
[互联网]
    ↑
[主路由（光猫）] ← 拨号上网，分配 IP（如 192.168.1.1）
    │
    ├─ 设备A（手机） → 网关=192.168.1.1 → 直接走主路由
    ├─ 设备B（电脑） → 网关=192.168.1.2 → 流量先到旁路由处理
    └─ [旁路由]（IP: 192.168.1.2）
          │
          └─（处理：去广告 / 科学上网 / 流量监控等）
```

> ⚠️ 关键点：**只有网关或 DNS 指向旁路由的设备，才会使用它的功能。**

---

## 三、如何配置旁路由？（以 OpenWrt 为例）

### 步骤 1：硬件连接
- 将软路由（如 N100 主机）的**一个网口**连接到主路由的 LAN 口（或交换机）。
- **不要连接 WAN 口**（旁路由不需要 WAN 口）。

### 步骤 2：设置旁路由的网络参数
登录软路由系统（如 OpenWrt）：

1. **LAN 口设置**（唯一接口）：
   - IP 地址：`192.168.1.2`（必须与主路由同网段，且不冲突）
   - 子网掩码：`255.255.255.0`
   - 网关：`192.168.1.1`（主路由 IP）
   - DNS：`192.168.1.1` 或 `114.114.114.114`

2. **关闭 DHCP 服务**：
   - 因为主路由已经分配 IP，旁路由不能再分配，否则会冲突。

3. **开启 IP 转发和防火墙**（关键！）：
   - 在 OpenWrt 中，默认已开启，但需确保：
     ```bash
     # /etc/config/firewall 中
     option forward 'ACCEPT'
     ```
   - 或在 Web 界面：**网络 → 防火墙 → 区域设置 → LAN 区域 → 允许转发**

4. **安装所需插件**：
   - 如 `AdGuard Home`（去广告）、`PassWall` 或 `Shadowsocks`（科学上网）、`DDNS` 等。

### 步骤 3：让设备使用旁路由

有两种方式（可单独或组合使用）：

#### ✅ 方式 A：修改设备的**默认网关**
- 手动设置设备的网络：
  - IP：`192.168.1.100`（或其他未被占用的）
  - 子网掩码：`255.255.255.0`
  - **网关：`192.168.1.2`（旁路由 IP）**
  - DNS：`192.168.1.2`（可选）

> 此时，该设备的所有流量都会经过旁路由处理，再由旁路由转发给主路由出去。

#### ✅ 方式 B：仅修改**DNS**（轻量级方案）
- 保持网关为 `192.168.1.1`，但将 DNS 改为 `192.168.1.2`
- 适用于只需要**广告过滤、家长控制、自定义域名解析**等 DNS 层功能
- **不支持需要代理的流量（如科学上网）**

> 💡 提示：可在主路由的 DHCP 设置中，将“DNS 服务器”强制设为旁路由 IP，这样所有设备自动使用旁路由的 DNS（但网关仍是主路由）。

---

## 四、旁路由的优缺点

### ✅ 优点：
| 优势 | 说明 |
|------|------|
| **零风险改动** | 不动主路由，不怕断网，适合新手 |
| **灵活控制** | 可选择哪些设备走旁路由（如只给手机开科学上网）|
| **故障隔离** | 旁路由宕机，其他设备仍可正常上网 |
| **节省硬件** | 不需要多网口设备（单网口即可）|

### ❌ 缺点：
| 劣势 | 说明 |
|------|------|
| **无法全局生效** | 默认情况下只有手动设置的设备才生效 |
| **回流问题（Hairpin NAT）** | 内网设备访问内网服务（如 NAS）可能绕道外网再回来，需额外配置 |
| **UDP 流量可能异常** | 某些游戏或语音应用对非标准网关敏感 |
| **不能处理主路由自身流量** | 光猫自身的更新、远程管理等仍走原路径 |

---

## 五、适用场景推荐

| 场景 | 是否适合旁路由 |
|------|----------------|
| 想给手机/电脑单独开科学上网 | ✅ 非常适合 |
| 全屋去广告（AdGuard Home） | ✅ 可通过 DHCP 强制 DNS 实现 |
| 家庭 NAS + 远程访问 | ⚠️ 需配合端口转发或内网穿透 |
| 游戏主机低延迟需求 | ❌ 建议直连主路由，避免额外跳转 |
| 学习网络知识、测试插件 | ✅ 安全、可随时关闭 |

---

## 六、进阶技巧

1. **配合 DHCP 选项强制 DNS**  
   在主路由（如果支持）中设置 DHCP 的 DNS 服务器为旁路由 IP，所有设备自动使用旁路由的 DNS 去广告。

2. **使用策略路由（高级）**  
   在旁路由上配置基于 MAC 或 IP 的分流规则，实现更精细控制。

3. **旁路由 + 无线 AP**  
   若旁路由带无线，可关闭其 DHCP，作为纯 AP 使用，同时提供 Wi-Fi 和旁路由功能。

---

## 总结

> **旁路由是一种“低侵入、高灵活”的软路由部署方式**，特别适合：
> - 不想/不能改光猫桥接的用户
> - 想按需启用高级功能的用户
> - 初学者练手或临时测试

虽然它不如“主路由模式”功能全面，但在大多数家庭场景下已经足够强大。**只需一台小主机 + 正确配置，就能让你的网络“悄悄升级”而不影响日常使用。**

如果你打算尝试，建议从 **OpenWrt + 旁路由 + AdGuard Home 去广告** 开始，体验立竿见影！


