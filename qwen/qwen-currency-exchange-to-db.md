# åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨æ¥ä¿å­˜ä¸‹é¢çš„æ•°æ®

{"success":true,"timestamp":1757094847,"base":"EUR","date":"2025-09-05","rates":{"AED":4.307868,"AFN":82.098882,"ALL":97.814356,"AMD":448.92862,"ANG":2.099132,"AOA":1075.495416,"ARS":1599.169583,"AUD":1.788823,"AWG":2.114047,"AZN":1.997402,"BAM":1.962941,"BBD":2.363398,"BDT":142.809519,"BGN":1.952617,"BHD":0.442142,"BIF":3461.055612,"BMD":1.172842,"BND":1.509792,"BOB":8.108497,"BRL":6.336038,"BSD":1.173469,"BTC":1.0605937e-5,"BTN":103.571778,"BWP":15.776392,"BYN":3.965125,"BYR":22987.695697,"BZD":2.359985,"CAD":1.623811,"CDF":3360.191694,"CHF":0.935459,"CLF":0.02895,"CLP":1135.685537,"CNY":8.376082,"CNH":8.356913,"COP":4659.347893,"CRC":594.562928,"CUC":1.172842,"CUP":31.080303,"CVE":111.009689,"CZK":24.384514,"DJF":208.437715,"DKK":7.465607,"DOP":74.370071,"DZD":152.308714,"EGP":56.977582,"ERN":17.592624,"ETB":167.188898,"EUR":1,"FJD":2.642183,"FKP":0.872743,"GBP":0.867662,"GEL":3.154907,"GGP":0.872743,"GHS":14.132638,"GIP":0.872743,"GMD":84.444578,"GNF":10150.944498,"GTQ":8.99974,"GYD":245.503102,"HKD":9.144793,"HNL":30.66959,"HRK":7.53293,"HTG":153.367929,"HUF":392.916605,"IDR":19207.040744,"ILS":3.924615,"IMP":0.872743,"INR":103.38593,"IQD":1536.422519,"IRR":49329.717999,"ISK":142.981191,"JEP":0.872743,"JMD":187.763053,"JOD":0.831511,"JPY":172.702689,"KES":151.875054,"KGS":102.564588,"KHR":4694.29854,"KMF":494.939461,"KPW":1055.581497,"KRW":1626.853501,"KWD":0.35828,"KYD":0.977857,"KZT":630.624113,"LAK":25438.934361,"LBP":105027.966528,"LKR":354.318958,"LRD":235.625203,"LSL":20.806069,"LTL":3.463096,"LVL":0.70944,"LYD":6.356854,"MAD":10.645297,"MDL":19.69565,"MGA":5248.466559,"MKD":61.76469,"MMK":2462.325586,"MNT":4217.090782,"MOP":9.430808,"MRU":46.832007,"MUR":54.079531,"MVR":18.058091,"MWK":2037.225892,"MXN":21.93334,"MYR":4.953846,"MZN":75.003309,"NAD":20.806494,"NGN":1793.661264,"NIO":42.984835,"NOK":11.777247,"NPR":165.714845,"NZD":1.989779,"OMR":0.450961,"PAB":1.173469,"PEN":4.131333,"PGK":4.881949,"PHP":66.40857,"PKR":332.764457,"PLN":4.24827,"PYG":8457.768058,"QAR":4.270084,"RON":5.075822,"RSD":117.177474,"RUB":95.283271,"RWF":1695.928978,"SAR":4.400775,"SBD":9.645183,"SCR":17.405619,"SDG":704.296946,"SEK":10.997061,"SGD":1.506345,"SHP":0.921669,"SLE":27.268831,"SLL":24593.899911,"SOS":670.283745,"SRD":45.597151,"STD":24275.453518,"STN":24.864242,"SVC":10.267351,"SYP":15249.412237,"SZL":20.805641,"THB":37.589976,"TJS":11.08894,"TMT":4.104946,"TND":3.413557,"TOP":2.74691,"TRY":48.384367,"TTD":7.963972,"TWD":35.727116,"TZS":2938.409199,"UAH":48.370264,"UGX":4128.017091,"USD":1.172842,"UYU":47.011019,"UZS":14587.20333,"VES":177.771145,"VND":30963.018694,"VUV":140.399366,"WST":3.245312,"XAF":658.351983,"XAG":0.02862,"XAU":0.000326,"XCD":3.169664,"XCG":2.114793,"XDR":0.821291,"XOF":659.136708,"XPF":119.331742,"YER":281.598082,"ZAR":20.625311,"ZMK":10556.980179,"ZMW":28.015918,"ZWL":377.654522}}

ä¸ºäº†ä¿å­˜ä½ æä¾›çš„æ±‡ç‡æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ª**å…³ç³»å‹æ•°æ®åº“è¡¨ç»“æ„**ï¼Œèƒ½å¤Ÿé«˜æ•ˆå­˜å‚¨åŸºç¡€è´§å¸ï¼ˆbaseï¼‰ã€æ—¥æœŸï¼ˆdateï¼‰ã€æ—¶é—´æˆ³ï¼ˆtimestampï¼‰ã€ä»¥åŠæ¯ä¸ªç›®æ ‡è´§å¸ï¼ˆå¦‚ USDã€CNY ç­‰ï¼‰å¯¹åº”çš„æ±‡ç‡ï¼ˆrateï¼‰ã€‚

---

## âœ… æ¨èè¡¨ç»“æ„è®¾è®¡

æˆ‘ä»¬å°†ä½¿ç”¨**â€œé•¿æ ¼å¼â€**ï¼ˆLong Formatï¼‰è®¾è®¡ï¼Œå³æ¯ä¸€è¡Œä»£è¡¨ä¸€ç§è´§å¸å¯¹ï¼ˆbase â†’ targetï¼‰åœ¨æŸä¸€å¤©çš„æ±‡ç‡ã€‚è¿™æ ·ä¾¿äºæ‰©å±•ã€æŸ¥è¯¢ã€èšåˆå’Œæ—¶é—´åºåˆ—åˆ†æã€‚

### ğŸ“„ è¡¨åï¼š`exchange_rates`

| å­—æ®µå         | æ•°æ®ç±»å‹           | è¯´æ˜                                     | çº¦æŸ               |
|----------------|--------------------|------------------------------------------|--------------------|
| id             | BIGINT AUTO_INCREMENT | ä¸»é”®ï¼Œè‡ªå¢                               | PRIMARY KEY        |
| base_currency  | CHAR(3)            | åŸºç¡€è´§å¸ä»£ç ï¼ˆå¦‚ EURï¼‰                   | NOT NULL           |
| target_currency| CHAR(3)            | ç›®æ ‡è´§å¸ä»£ç ï¼ˆå¦‚ USD, CNYï¼‰              | NOT NULL           |
| rate           | DECIMAL(18, 8)     | æ±‡ç‡å€¼ï¼ˆé«˜ç²¾åº¦å°æ•°ï¼‰                     | NOT NULL           |
| date           | DATE               | æ±‡ç‡å¯¹åº”çš„æ—¥æœŸ                           | NOT NULL           |
| timestamp      | BIGINT             | Unix æ—¶é—´æˆ³ï¼ˆç§’ï¼‰                        | NOT NULL           |
| created_at     | DATETIME           | è®°å½•æ’å…¥æ—¶é—´ï¼ˆå¯é€‰ï¼‰                     | DEFAULT CURRENT_TIMESTAMP |

---

## âœ… SQL åˆ›å»ºè¯­å¥ï¼ˆMySQL / PostgreSQL å…¼å®¹è¯­æ³•ï¼‰

```sql
CREATE TABLE exchange_rates (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    base_currency CHAR(3) NOT NULL,
    target_currency CHAR(3) NOT NULL,
    rate DECIMAL(18, 8) NOT NULL,
    date DATE NOT NULL,
    timestamp BIGINT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    -- å¯é€‰ï¼šæ·»åŠ å”¯ä¸€çº¦æŸé˜²æ­¢é‡å¤æ’å…¥åŒä¸€å¤©åŒä¸€è´§å¸å¯¹
    UNIQUE KEY unique_rate_per_day (base_currency, target_currency, date)
);
```

> ğŸ’¡ **è¯´æ˜ï¼š**
> - `DECIMAL(18,8)` è¶³å¤Ÿå­˜å‚¨å¦‚ `1.0605937e-5`ï¼ˆå³ 0.00001060ï¼‰è¿™ç§å°æ•°å€¼ã€‚
> - `UNIQUE` çº¦æŸç¡®ä¿ä¸ä¼šé‡å¤æ’å…¥ç›¸åŒåŸºç¡€è´§å¸ã€ç›®æ ‡è´§å¸å’Œæ—¥æœŸçš„è®°å½•ã€‚
> - `created_at` ç”¨äºè¿½è¸ªæ•°æ®æ’å…¥æ—¶é—´ï¼Œä¾¿äºå®¡è®¡æˆ–å¢é‡åŒæ­¥ã€‚

---

## âœ… ç¤ºä¾‹æ•°æ®æ’å…¥ï¼ˆéƒ¨åˆ†ï¼‰

æ ¹æ®ä½ æä¾›çš„ JSON æ•°æ®ï¼Œæ’å…¥ EUR â†’ USD å’Œ EUR â†’ CNY çš„ç¤ºä¾‹ï¼š

```sql
INSERT INTO exchange_rates (base_currency, target_currency, rate, date, timestamp)
VALUES 
('EUR', 'USD', 1.17284200, '2025-09-05', 1757094847),
('EUR', 'CNY', 8.37608200, '2025-09-05', 1757094847),
('EUR', 'JPY', 172.70268900, '2025-09-05', 1757094847),
('EUR', 'BTC', 0.00001061, '2025-09-05', 1757094847); -- 1.0605937e-5
```

> âš ï¸ æ³¨æ„ï¼šå¯¹äº `BTC` è¿™ç±»æå°æ•°å€¼ï¼Œ`DECIMAL(18,8)` ä¼šå››èˆäº”å…¥åˆ° 8 ä½å°æ•°ï¼Œå¦‚ `0.00001061`ã€‚å¦‚éœ€æ›´é«˜ç²¾åº¦ï¼Œå¯è°ƒæ•´ä¸º `DECIMAL(25,15)`ã€‚

---

## âœ… å¯é€‰ä¼˜åŒ–ï¼šç´¢å¼•

ä¸ºåŠ é€ŸæŒ‰æ—¥æœŸã€è´§å¸æŸ¥è¯¢ï¼Œå»ºè®®æ·»åŠ ç´¢å¼•ï¼š

```sql
CREATE INDEX idx_exchange_rate_date ON exchange_rates (date);
CREATE INDEX idx_exchange_rate_base_target ON exchange_rates (base_currency, target_currency);
```

---

## âœ… å¦‚ä½•ä» JSON æ‰¹é‡æ’å…¥ï¼Ÿ

ä½ å¯ä»¥ç”¨ Pythonã€Node.jsã€æˆ–å…¶ä»–è„šæœ¬è¯­è¨€è§£æ JSONï¼Œç„¶åæ‰¹é‡ç”Ÿæˆ `INSERT` è¯­å¥æˆ–ä½¿ç”¨ `INSERT ... VALUES (...), (...), ...` æ‰¹é‡æ’å…¥ã€‚

### Python ä¼ªä»£ç ç¤ºä¾‹ï¼š

```python
import json

data = json.loads(json_string)  # ä½ çš„åŸå§‹ JSON

base = data['base']
date = data['date']
timestamp = data['timestamp']
rates = data['rates']

inserts = []
for currency, rate in rates.items():
    inserts.append(f"('{base}', '{currency}', {rate:.8f}, '{date}', {timestamp})")

sql = "INSERT INTO exchange_rates (base_currency, target_currency, rate, date, timestamp) VALUES " + ", ".join(inserts) + ";"
print(sql)
```

---

## âœ… æŸ¥è¯¢ç¤ºä¾‹

### æŸ¥è¯¢æŸå¤© EUR å¯¹æ‰€æœ‰è´§å¸çš„æ±‡ç‡ï¼š

```sql
SELECT target_currency, rate
FROM exchange_rates
WHERE base_currency = 'EUR' AND date = '2025-09-05';
```

### æŸ¥è¯¢ EUR â†’ USD æœ€è¿‘ 30 å¤©è¶‹åŠ¿ï¼š

```sql
SELECT date, rate
FROM exchange_rates
WHERE base_currency = 'EUR' AND target_currency = 'USD'
ORDER BY date DESC
LIMIT 30;
```

---

## âœ… ä¸ºä»€ä¹ˆä¸å»ºè®®ç”¨â€œå®½è¡¨â€ï¼ˆæ¯åˆ—ä¸€ä¸ªè´§å¸ï¼‰ï¼Ÿ

è™½ç„¶ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å« 170+ åˆ—çš„è¡¨ï¼ˆæ¯åˆ—ä¸€ä¸ªè´§å¸ï¼‰ï¼Œä½†ï¼š

- ä¸æ˜“æ‰©å±•ï¼ˆæ–°å¢è´§å¸éœ€æ”¹è¡¨ç»“æ„ï¼‰
- æŸ¥è¯¢ä¸çµæ´»ï¼ˆä¸èƒ½è½»æ¾æŒ‰è´§å¸åç­›é€‰ï¼‰
- æµªè´¹ç©ºé—´ï¼ˆå¾ˆå¤šè´§å¸å¯èƒ½ä¸ºç©ºï¼‰
- ä¸ç¬¦åˆæ•°æ®åº“èŒƒå¼

---

## âœ… æ€»ç»“

âœ… ä½¿ç”¨ `exchange_rates` è¡¨ï¼ŒæŒ‰â€œé•¿æ ¼å¼â€è®¾è®¡ï¼Œæ˜¯æœ€ä½³å®è·µã€‚

âœ… æ”¯æŒä»»æ„è´§å¸å¯¹ã€ä»»æ„æ—¥æœŸã€é«˜æ•ˆæŸ¥è¯¢ä¸æ‰©å±•ã€‚

âœ… å¯è½»æ¾æ”¯æŒå¤šåŸºç¡€è´§å¸ï¼ˆå¦‚æœªæ¥åŠ å…¥ USD ä¸ºåŸºç¡€çš„æ±‡ç‡ï¼‰ã€‚

âœ… æ˜“äºä¸ BI å·¥å…·ã€APIã€å‰ç«¯é›†æˆã€‚

---

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ **PostgreSQL**ï¼Œè¯­æ³•å‡ ä¹ä¸€è‡´ï¼Œåªéœ€æŠŠ `AUTO_INCREMENT` æ”¹ä¸º `SERIAL` æˆ– `BIGSERIAL`ã€‚

éœ€è¦æˆ‘å¸®ä½ ç”Ÿæˆå®Œæ•´æ‰¹é‡æ’å…¥ SQL æˆ– Python è„šæœ¬å—ï¼Ÿæ¬¢è¿ç»§ç»­æé—®ï¼

# æŠŠæ‰€æœ‰çš„æ±‡ç‡æ•°æ®ä»å…¥ä¸€ä¸ªjsonå­—æ®µå¦‚ä½•ï¼Ÿ

éå¸¸å¥½çš„é—®é¢˜ï¼å¦‚æœä½ å¸Œæœ›**å°†æ‰€æœ‰æ±‡ç‡æ•°æ®ä½œä¸ºä¸€ä¸ª JSON å­—æ®µæ•´ä½“å­˜å‚¨**ï¼Œè€Œä¸æ˜¯æ‹†åˆ†æˆå¤šè¡Œï¼ˆé•¿æ ¼å¼ï¼‰ï¼Œè¿™æ˜¯å®Œå…¨å¯è¡Œçš„ â€”â€” å°¤å…¶åœ¨ä½ ï¼š

- ä¸éœ€è¦é¢‘ç¹æŒ‰å•ä¸ªè´§å¸æŸ¥è¯¢æˆ–èšåˆï¼›
- å¸Œæœ›ä¿æŒåŸå§‹ JSON ç»“æ„å®Œæ•´ï¼›
- ä½¿ç”¨çš„æ˜¯æ”¯æŒ JSON ç±»å‹çš„ç°ä»£æ•°æ®åº“ï¼ˆå¦‚ MySQL 5.7+ã€PostgreSQL 9.3+ï¼‰ï¼›
- æ•°æ®ä¸»è¦ç”¨äºâ€œæ•´ä½“è¯»å–/å†™å…¥â€ï¼Œè€Œä¸æ˜¯â€œåˆ†æå•ä¸ªè´§å¸â€ã€‚

---

## âœ… æ¨èæ–¹æ¡ˆï¼šä½¿ç”¨å•è¡¨ + JSON å­—æ®µå­˜å‚¨å®Œæ•´æ±‡ç‡æ•°æ®

### ğŸ“„ è¡¨åï¼š`exchange_rate_snapshots`

| å­—æ®µå        | æ•°æ®ç±»å‹       | è¯´æ˜                                     | çº¦æŸ               |
|---------------|----------------|------------------------------------------|--------------------|
| id            | BIGINT AUTO_INCREMENT | ä¸»é”®                                   | PRIMARY KEY        |
| base_currency | CHAR(3)        | åŸºç¡€è´§å¸ï¼ˆå¦‚ EURï¼‰                       | NOT NULL           |
| date          | DATE           | æ±‡ç‡æ—¥æœŸ                                 | NOT NULL, UNIQUE   |
| timestamp     | BIGINT         | Unix æ—¶é—´æˆ³                              | NOT NULL           |
| rates         | JSON           | æ‰€æœ‰ç›®æ ‡è´§å¸æ±‡ç‡çš„ JSON å¯¹è±¡             | NOT NULL           |
| created_at    | DATETIME       | è®°å½•æ’å…¥æ—¶é—´                             | DEFAULT CURRENT_TIMESTAMP |

> ğŸ’¡ `rates` å­—æ®µå°†ç›´æ¥å­˜å‚¨å¦‚ï¼š`{"USD": 1.172842, "CNY": 8.376082, ...}`

---

## âœ… SQL åˆ›å»ºè¯­å¥

### â–¶ MySQL ç‰ˆæœ¬ï¼ˆæ¨è 5.7+ï¼‰

```sql
CREATE TABLE exchange_rate_snapshots (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    base_currency CHAR(3) NOT NULL,
    date DATE NOT NULL,
    timestamp BIGINT NOT NULL,
    rates JSON NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY unique_snapshot_per_day (base_currency, date)
);
```

### â–¶ PostgreSQL ç‰ˆæœ¬ï¼ˆæ¨è 9.5+ï¼‰

```sql
CREATE TABLE exchange_rate_snapshots (
    id BIGSERIAL PRIMARY KEY,
    base_currency CHAR(3) NOT NULL,
    date DATE NOT NULL,
    timestamp BIGINT NOT NULL,
    rates JSONB NOT NULL,  -- PostgreSQL æ¨èç”¨ JSONBï¼Œæ”¯æŒç´¢å¼•å’Œé«˜æ•ˆæŸ¥è¯¢
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE (base_currency, date)
);
```

> âœ… PostgreSQL ç”¨æˆ·å¼ºçƒˆæ¨èä½¿ç”¨ `JSONB` è€Œä¸æ˜¯ `JSON` â€”â€” å®ƒæ”¯æŒç´¢å¼•ã€æ›´å¿«çš„æŸ¥è¯¢å’Œæ“ä½œç¬¦ã€‚

---

## âœ… æ’å…¥ç¤ºä¾‹ï¼ˆMySQL / PostgreSQL è¯­æ³•ç±»ä¼¼ï¼‰

```sql
INSERT INTO exchange_rate_snapshots (base_currency, date, timestamp, rates)
VALUES (
    'EUR',
    '2025-09-05',
    1757094847,
    '{
        "AED": 4.307868,
        "AFN": 82.098882,
        "ALL": 97.814356,
        "USD": 1.172842,
        "CNY": 8.376082,
        "BTC": 0.000010605937,
        ...
    }'::JSON  -- PostgreSQL éœ€è¦ç±»å‹è½¬æ¢ï¼ŒMySQL ä¸éœ€è¦
);
```

> âš ï¸ æ³¨æ„ï¼šåœ¨ PostgreSQL ä¸­ï¼Œå­—ç¬¦ä¸²è½¬ JSON éœ€åŠ  `::JSON` æˆ– `::JSONB`ï¼›MySQL ä¼šè‡ªåŠ¨è½¬æ¢ã€‚

---

## âœ… æŸ¥è¯¢ç¤ºä¾‹

### â–¶ æŸ¥è¯¢æŸå¤©å®Œæ•´æ±‡ç‡æ•°æ®ï¼ˆåŸå§‹ JSONï¼‰

```sql
SELECT base_currency, date, rates
FROM exchange_rate_snapshots
WHERE date = '2025-09-05' AND base_currency = 'EUR';
```

### â–¶ æŸ¥è¯¢ç‰¹å®šè´§å¸çš„æ±‡ç‡ï¼ˆå¦‚ USDï¼‰â€”â€” MySQL

```sql
SELECT 
    date,
    base_currency,
    JSON_EXTRACT(rates, '$.USD') AS usd_rate
FROM exchange_rate_snapshots
WHERE base_currency = 'EUR' AND date = '2025-09-05';
```

### â–¶ PostgreSQL æŸ¥è¯¢ç‰¹å®šè´§å¸ï¼ˆä½¿ç”¨ `->>` æå–æ–‡æœ¬ï¼‰

```sql
SELECT 
    date,
    base_currency,
    (rates->>'USD')::NUMERIC AS usd_rate
FROM exchange_rate_snapshots
WHERE base_currency = 'EUR' AND date = '2025-09-05';
```

### â–¶ æŸ¥è¯¢æ‰€æœ‰åŒ…å« BTC æ±‡ç‡ > 0.00001 çš„è®°å½•ï¼ˆPostgreSQLï¼‰

```sql
SELECT date, base_currency, (rates->>'BTC')::NUMERIC AS btc_rate
FROM exchange_rate_snapshots
WHERE (rates->>'BTC')::NUMERIC > 0.00001;
```

> ğŸ’¡ PostgreSQL çš„ `JSONB` æ”¯æŒ GIN ç´¢å¼•åŠ é€Ÿé”®æŸ¥è¯¢ï¼š

```sql
-- ä¸ºå¸¸ç”¨è´§å¸åˆ›å»ºç´¢å¼•ï¼ˆPostgreSQLï¼‰
CREATE INDEX idx_rates_usd ON exchange_rate_snapshots USING GIN ((rates -> 'USD'));
-- æˆ–æ›´é€šç”¨çš„è·¯å¾„ç´¢å¼•
CREATE INDEX idx_rates_path ON exchange_rate_snapshots USING GIN (rates jsonb_path_ops);
```

MySQL 8.0+ ä¹Ÿæ”¯æŒå¯¹ JSON å­—æ®µçš„éƒ¨åˆ†ç´¢å¼•ï¼š

```sql
-- MySQL 8.0+
CREATE INDEX idx_rates_usd ON exchange_rate_snapshots ((CAST(rates->>'$.USD' AS DECIMAL(18,8))));
```

---

## âœ… ä¼˜ç¼ºç‚¹å¯¹æ¯”

| ç»´åº¦             | JSON å­—æ®µæ–¹æ¡ˆï¼ˆå®½æ ¼å¼ï¼‰              | é•¿æ ¼å¼ï¼ˆæ¯è¡Œä¸€ä¸ªè´§å¸ï¼‰             |
|------------------|--------------------------------------|-----------------------------------|
| å­˜å‚¨ç»“æ„         | ä¿æŒåŸå§‹ç»“æ„ï¼Œæ˜“è¯»                   | æ‹†æ•£ï¼Œç»“æ„èŒƒå¼åŒ–                  |
| æŸ¥è¯¢çµæ´»æ€§       | ä¸­ç­‰ï¼ˆéœ€ JSON å‡½æ•°ï¼‰                 | é«˜ï¼ˆç›´æ¥ WHERE / JOINï¼‰           |
| æ‰©å±•æ€§           | é«˜ï¼ˆæ— éœ€æ”¹è¡¨ç»“æ„ï¼‰                   | é«˜                                |
| åˆ†æ/èšåˆ        | è¾ƒéš¾ï¼ˆéœ€æå–åè½¬æ¢ï¼‰                 | éå¸¸å®¹æ˜“                          |
| ç´¢å¼•æ”¯æŒ         | æœ‰é™ï¼ˆéœ€ç‰¹å®šè¯­æ³•/ç‰ˆæœ¬ï¼‰              | å®Œå…¨æ”¯æŒ                          |
| é€‚åˆåœºæ™¯         | å¿«ç…§å­˜å‚¨ã€API ç¼“å­˜ã€é…ç½®ç±»æ•°æ®       | æ•°æ®åˆ†æã€BIã€é¢‘ç¹æŒ‰è´§å¸æŸ¥è¯¢      |
| å­˜å‚¨ç©ºé—´         | ç•¥é«˜ï¼ˆå«é”®åï¼‰                       | ç•¥ä½                              |

---

## âœ… æœ€ä½³å®è·µå»ºè®®

- âœ… å¦‚æœä½ ä¸»è¦åšâ€œæ±‡ç‡å¿«ç…§å½’æ¡£â€æˆ–â€œAPI å“åº”ç¼“å­˜â€ï¼Œæ¨è **JSON å­—æ®µæ–¹æ¡ˆ**ã€‚
- âœ… å¦‚æœä½ è¦åšâ€œè¶‹åŠ¿åˆ†æâ€ã€â€œè´§å¸å¯¹æ¯”â€ã€â€œBI æŠ¥è¡¨â€ï¼Œæ¨è **é•¿æ ¼å¼æ‹†åˆ†æ–¹æ¡ˆ**ã€‚
- âœ… ç”šè‡³å¯ä»¥ä¸¤è€…**åŒæ—¶å­˜åœ¨**ï¼šç”¨ JSON å­˜åŸå§‹æ•°æ®ï¼Œç”¨è§¦å‘å™¨æˆ– ETL åŒæ­¥åˆ°é•¿æ ¼å¼è¡¨ç”¨äºåˆ†æã€‚

---

## âœ… Python æ’å…¥ç¤ºä¾‹ï¼ˆå®Œæ•´ JSON æ’å…¥ï¼‰

```python
import json
import mysql.connector  # æˆ– psycopg2ï¼ˆPostgreSQLï¼‰

# å‡è®¾ data æ˜¯ä½ çš„åŸå§‹å­—å…¸
data = {
    "success": True,
    "timestamp": 1757094847,
    "base": "EUR",
    "date": "2025-09-05",
    "rates": {
        "USD": 1.172842,
        "CNY": 8.376082,
        "JPY": 172.702689,
        # ... å…¶ä»–è´§å¸
    }
}

# å‡†å¤‡æ’å…¥
conn = mysql.connector.connect(...)
cursor = conn.cursor()

sql = """
INSERT INTO exchange_rate_snapshots (base_currency, date, timestamp, rates)
VALUES (%s, %s, %s, %s)
"""

cursor.execute(sql, (
    data['base'],
    data['date'],
    data['timestamp'],
    json.dumps(data['rates'])  # è½¬ä¸º JSON å­—ç¬¦ä¸²
))

conn.commit()
```

---

## âœ… æ€»ç»“

> æ˜¯çš„ï¼Œ**æŠŠæ‰€æœ‰æ±‡ç‡å­˜å…¥ä¸€ä¸ª JSON å­—æ®µæ˜¯å®Œå…¨åˆç†ä¸”å®ç”¨çš„æ–¹æ¡ˆ**ï¼Œå°¤å…¶é€‚åˆï¼š

- ä¿æŒæ•°æ®åŸå§‹ç»“æ„
- å¿«é€Ÿå†™å…¥/è¯»å–æ•´ä»½æ•°æ®
- ä¸é¢‘ç¹æŸ¥è¯¢å•ä¸ªè´§å¸
- ä½¿ç”¨ç°ä»£æ•°æ®åº“ï¼ˆMySQL 5.7+ / PostgreSQL 9.5+ï¼‰

å¦‚æœä½ åç»­éœ€è¦åˆ†æèƒ½åŠ›ï¼Œå¯ä»¥å†é…åˆç‰©åŒ–è§†å›¾ã€ETL æˆ–é•¿æ ¼å¼è¡¨åšè¡¥å……ã€‚

---

éœ€è¦æˆ‘å¸®ä½ ç”Ÿæˆå®Œæ•´æ’å…¥è¯­å¥ã€ç´¢å¼•ä¼˜åŒ–æ–¹æ¡ˆã€æˆ–æ··åˆæ¶æ„ï¼ˆJSON + é•¿æ ¼å¼ï¼‰å—ï¼Ÿæ¬¢è¿ç»§ç»­æé—® ğŸ˜Š

# ç”¨golangç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œä»http://data.fixer.io/api/latest?access_key=MY-KEYè·å–å¦‚ä¸Šæ‰€ç¤ºçš„jsonæ ¼å¼çš„æ•°æ®ï¼Œç„¶åå­˜å…¥mysqlæ•°æ®åº“

ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ **Go è¯­è¨€ç¨‹åº**ï¼Œå®ƒï¼š

1. ä» `http://data.fixer.io/api/latest?access_key=MY-KEY` è·å–æ±‡ç‡æ•°æ®ï¼ˆJSON æ ¼å¼ï¼‰ï¼›
2. è§£æ JSON æ•°æ®ï¼›
3. è¿æ¥ MySQL æ•°æ®åº“ï¼›
4. å°†æ•°æ®ä»¥ **JSON å­—æ®µæ•´ä½“å­˜å‚¨** çš„æ–¹å¼æ’å…¥åˆ°è¡¨ `exchange_rate_snapshots` ä¸­ï¼ˆå¦‚ä½ ä¹‹å‰è¦æ±‚ï¼‰ï¼›
5. å¤„ç†é”™è¯¯ã€é‡å¤æ•°æ®ï¼ˆåˆ©ç”¨ `ON DUPLICATE KEY UPDATE` é¿å…é‡å¤ï¼‰ã€‚

---

## âœ… å‰ææ¡ä»¶

- Go 1.19+
- MySQL 5.7+ï¼ˆæ”¯æŒ JSON ç±»å‹ï¼‰
- å·²åˆ›å»ºè¡¨ `exchange_rate_snapshots`ï¼ˆè§ä¸‹æ–¹ SQLï¼‰
- æ›¿æ¢ `MY-KEY` ä¸ºä½ çš„ Fixer.io API Key
- å®‰è£…ä¾èµ–ï¼š`go get github.com/go-sql-driver/mysql`

---

## âœ… 1. åˆ›å»º MySQL è¡¨ç»“æ„ï¼ˆå¦‚ä¹‹å‰è®¾è®¡ï¼‰

```sql
CREATE TABLE exchange_rate_snapshots (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    base_currency CHAR(3) NOT NULL,
    date DATE NOT NULL,
    timestamp BIGINT NOT NULL,
    rates JSON NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY unique_snapshot_per_day (base_currency, date)
);
```

---

## âœ… 2. Go ç¨‹åºä»£ç  (`main.go`)

```go
package main

import (
	"encoding/json"
	"fmt"
	"log"
	"net/http"
	"time"

	"github.com/go-sql-driver/mysql"
)

// FixerResponse å®šä¹‰ API è¿”å›çš„ JSON ç»“æ„
type FixerResponse struct {
	Success   bool              `json:"success"`
	Timestamp int64             `json:"timestamp"`
	Base      string            `json:"base"`
	Date      string            `json:"date"` // æ ¼å¼: "2025-09-05"
	Rates     map[string]any    `json:"rates"` // ä½¿ç”¨ any ä»¥å…¼å®¹ä¸åŒæ•°å€¼ç±»å‹
}

func main() {
	// === 1. è®¾ç½®æ•°æ®åº“è¿æ¥ ===
	cfg := mysql.Config{
		User:                 "your_mysql_user",
		Passwd:               "your_mysql_password",
		Net:                  "tcp",
		Addr:                 "127.0.0.1:3306",
		DBName:               "your_database_name",
		AllowNativePasswords: true,
	}

	db, err := sql.Open("mysql", cfg.FormatDSN())
	if err != nil {
		log.Fatal("æ•°æ®åº“è¿æ¥å¤±è´¥:", err)
	}
	defer db.Close()

	// æµ‹è¯•è¿æ¥
	if err := db.Ping(); err != nil {
		log.Fatal("æ•°æ®åº“ Ping å¤±è´¥:", err)
	}
	fmt.Println("âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ")

	// === 2. è°ƒç”¨ Fixer API ===
	apiURL := "http://data.fixer.io/api/latest?access_key=YOUR_ACCESS_KEY_HERE" // ğŸ”‘ æ›¿æ¢ä¸ºä½ çš„ KEY

	resp, err := http.Get(apiURL)
	if err != nil {
		log.Fatal("HTTP è¯·æ±‚å¤±è´¥:", err)
	}
	defer resp.Body.Close()

	if resp.StatusCode != http.StatusOK {
		log.Fatalf("API è¿”å›é”™è¯¯çŠ¶æ€ç : %d", resp.StatusCode)
	}

	// è§£æ JSON
	var fixerResp FixerResponse
	if err := json.NewDecoder(resp.Body).Decode(&fixerResp); err != nil {
		log.Fatal("JSON è§£æå¤±è´¥:", err)
	}

	if !fixerResp.Success {
		log.Fatal("API è¿”å› success=false")
	}

	// è§£ææ—¥æœŸå­—ç¬¦ä¸²ä¸º DATE ç±»å‹ï¼ˆMySQL éœ€è¦ 'YYYY-MM-DD'ï¼‰
	dateParsed, err := time.Parse("2006-01-02", fixerResp.Date)
	if err != nil {
		log.Fatal("æ—¥æœŸè§£æå¤±è´¥:", err)
	}
	dateStr := dateParsed.Format("2006-01-02")

	// åºåˆ—åŒ– rates ä¸º JSON å­—ç¬¦ä¸²
	ratesJSON, err := json.Marshal(fixerResp.Rates)
	if err != nil {
		log.Fatal("åºåˆ—åŒ– rates å¤±è´¥:", err)
	}

	// === 3. æ’å…¥æ•°æ®åº“ï¼ˆé¿å…é‡å¤ï¼‰===
	query := `
		INSERT INTO exchange_rate_snapshots (base_currency, date, timestamp, rates)
		VALUES (?, ?, ?, ?)
		ON DUPLICATE KEY UPDATE
			timestamp = VALUES(timestamp),
			rates = VALUES(rates)
	`

	_, err = db.Exec(query,
		fixerResp.Base,
		dateStr,
		fixerResp.Timestamp,
		ratesJSON,
	)
	if err != nil {
		log.Fatal("æ’å…¥æ•°æ®åº“å¤±è´¥:", err)
	}

	fmt.Printf("âœ… æ±‡ç‡å¿«ç…§å·²ä¿å­˜: Base=%s, Date=%s, Timestamp=%d\n",
		fixerResp.Base, fixerResp.Date, fixerResp.Timestamp)
}
```

---

## âœ… 3. è¿è¡Œå‰å‡†å¤‡

### ğŸ”§ å®‰è£…ä¾èµ–

```bash
go mod init fixer-to-mysql
go get github.com/go-sql-driver/mysql
```

### ğŸ” æ›¿æ¢æ•æ„Ÿä¿¡æ¯

åœ¨ä»£ç ä¸­æ›¿æ¢ï¼š

```go
cfg := mysql.Config{
	User:   "your_mysql_user",       // ğŸ‘ˆ æ›¿æ¢
	Passwd: "your_mysql_password",   // ğŸ‘ˆ æ›¿æ¢
	DBName: "your_database_name",    // ğŸ‘ˆ æ›¿æ¢
}

apiURL := "http://data.fixer.io/api/latest?access_key=YOUR_ACCESS_KEY_HERE" // ğŸ‘ˆ æ›¿æ¢
```

---

## âœ… 4. ç¼–è¯‘ & è¿è¡Œ

```bash
go run main.go
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
âœ… æ±‡ç‡å¿«ç…§å·²ä¿å­˜: Base=EUR, Date=2025-09-05, Timestamp=1757094847
```

---

## âœ… 5. éªŒè¯æ•°æ®

ç™»å½• MySQLï¼Œæ‰§è¡Œï¼š

```sql
SELECT base_currency, date, JSON_EXTRACT(rates, '$.USD') AS usd_rate
FROM exchange_rate_snapshots
ORDER BY id DESC
LIMIT 1;
```

åº”çœ‹åˆ°ç±»ä¼¼ï¼š

```
+----------------+------------+----------+
| base_currency  | date       | usd_rate |
+----------------+------------+----------+
| EUR            | 2025-09-05 | 1.172842 |
+----------------+------------+----------+
```

---

## âœ… å¯é€‰å¢å¼ºåŠŸèƒ½

### ğŸ”„ æ”¯æŒå®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©æ‹‰å–ï¼‰

ä½ å¯ä»¥ç”¨ `cron` åŒ…ï¼ˆå¦‚ `github.com/robfig/cron/v3`ï¼‰æ¯å¤©å®šæ—¶æ‰§è¡Œï¼š

```go
c := cron.New()
c.AddFunc("@daily", fetchAndStoreRate)
c.Start()
select {} // é˜»å¡ä¸» goroutine
```

### ğŸ“Š æ”¯æŒé•¿æ ¼å¼å­˜å‚¨ï¼ˆæ‹†åˆ†æ¯è´§å¸ä¸€è¡Œï¼‰

å¦‚æœä½ åç»­æƒ³æ”¯æŒåˆ†æï¼Œå¯ä»¥æ‰©å±•ç¨‹åºï¼ŒåŒæ—¶å†™å…¥ `exchange_rates`ï¼ˆé•¿æ ¼å¼è¡¨ï¼‰ã€‚

---

## âœ… é”™è¯¯å¤„ç† & å¥å£®æ€§å»ºè®®

- æ·»åŠ é‡è¯•æœºåˆ¶ï¼ˆå¦‚ä½¿ç”¨ `github.com/hashicorp/go-retryablehttp`ï¼‰
- è®°å½•æ—¥å¿—åˆ°æ–‡ä»¶ï¼ˆå¦‚ `logrus` æˆ– `zap`ï¼‰
- æ·»åŠ ç›‘æ§/å‘Šè­¦ï¼ˆå¦‚æ’å…¥å¤±è´¥å‘ Slack/Webhookï¼‰
- æ”¯æŒ HTTPSï¼ˆFixer.io æ¨èç”¨ `https://`ï¼‰

---

## âœ… æœ€ç»ˆç›®å½•ç»“æ„å»ºè®®

```
fixer-to-mysql/
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ main.go
```

---

âœ… **è¿™ä¸ªç¨‹åºå¼€ç®±å³ç”¨ï¼Œé€‚åˆéƒ¨ç½²ä¸ºå®šæ—¶ä»»åŠ¡æˆ–å¾®æœåŠ¡ï¼Œç¨³å®šæŠ“å–å¹¶å­˜å‚¨æ±‡ç‡å¿«ç…§ã€‚**

éœ€è¦æˆ‘å¸®ä½ æ·»åŠ â€œé•¿æ ¼å¼å­˜å‚¨â€ã€â€œé”™è¯¯é‡è¯•â€ã€â€œé…ç½®æ–‡ä»¶æ”¯æŒâ€æˆ–â€œDocker éƒ¨ç½²â€å—ï¼Ÿæ¬¢è¿ç»§ç»­æé—®ï¼
